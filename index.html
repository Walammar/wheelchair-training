<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Wheelchair Training — Pointer Lock Joystick</title>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
  <style>
    body { margin:0; background:#222; color:#fff; font-family:sans-serif; }
    #instructions {
      position:absolute; top:50%; left:50%; transform:translate(-50%,-50%);
      background:rgba(0,0,0,0.7); padding:20px; border-radius:10px;
    }
  </style>
</head>
<body>

<div id="instructions">
  <h2>Click to start</h2>
  <p>Your Optima joystick will now control the wheelchair.<br>
  Move it to navigate. Press ESC to release control.</p>
</div>

<script>
(() => {
  const config = {
    type: Phaser.AUTO,
    width: 800,
    height: 600,
    backgroundColor: '#111',
    physics: { default: 'arcade', arcade: { debug:false } },
    scene: { preload, create, update }
  };
  const game = new Phaser.Game(config);

  let player, walls, goal;
  let vx = 0, vy = 0;

  function preload(){}

  function create(){
    const scene = this;

    // Player
    player = this.add.circle(400,300,20,0x6699ff);
    this.physics.add.existing(player);
    player.body.setCollideWorldBounds(true);

    // Walls
    walls = this.physics.add.staticGroup();
    walls.create(400,10,'').setDisplaySize(800,20).refreshBody();
    walls.create(400,590,'').setDisplaySize(800,20).refreshBody();
    walls.create(10,300,'').setDisplaySize(20,600).refreshBody();
    walls.create(790,300,'').setDisplaySize(20,600).refreshBody();

    // Goal
    goal = this.add.rectangle(740,540,40,40,0x00ff00);
    this.physics.add.existing(goal,true);

    this.physics.add.collider(player,walls);
    this.physics.add.overlap(player,goal,()=>alert("✅ Goal Reached!"));

    // Pointer lock activation
    this.input.on('pointerdown', () => {
      this.input.mouse.requestPointerLock();
    });

    // Capture movement deltas
    this.input.mouse.disableContextMenu();
    this.input.on('pointermove', (pointer) => {
      if (this.input.mouse.locked) {
        vx += pointer.movementX;
        vy += pointer.movementY;
      }
    });
  }

  function update(){
    // Scale velocity down so it's not crazy fast
    const speed = 2;
    player.body.setVelocity(vx*speed, vy*speed);

    // Apply damping to simulate friction
    vx *= 0.9;
    vy *= 0.9;
  }
})();
</script>

</body>
</html>
