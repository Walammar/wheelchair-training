
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Wheelchair Training - Step Joystick + Max Speed</title>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.js"></script>
  <style>
    body, html { margin:0; padding:0; overflow:hidden; height:100%; background:#000; }
    #gameContainer { width:100%; height:100%; }
    #settingsPanel {
      position: absolute; top: 10px; left: 10px;
      background: rgba(255,255,255,0.9); padding:10px; border-radius:8px;
      display: none; z-index: 5; width: 240px;
    }
    #toggleBtn {
      position: absolute; top: 10px; left: 10px; z-index:6;
      background:#333; color:white; border:none; padding:5px 10px; border-radius:5px;
    }
    #overlay {
      position: absolute; top:0; left:0; width:100%; height:100%;
      background: rgba(0,0,0,0.7); color:white; display:none;
      justify-content:center; align-items:center; flex-direction:column;
      z-index:10; font-size:2em;
    }
    #overlay button {
      margin-top:20px; padding:10px 20px; font-size:1em; border:none; border-radius:5px;
      background:#fff; color:#000;
    }
  </style>
</head>
<body>
  <button id="toggleBtn">⚙️</button>
  <div id="settingsPanel">
    <label>Sensitivity <input type="range" id="sensitivity" min="1" max="20" step="1" value="5"></label><br>
    <label>Deadzone <input type="range" id="deadzone" min="0" max="20" step="1" value="5"></label><br>
    <label>Max Speed <input type="range" id="maxSpeed" min="50" max="500" step="10" value="200"></label>
    <span id="maxSpeedLabel">200</span><br>
    <label>Player Size <input type="range" id="playerSize" min="20" max="100" step="5" value="50"></label><br>
    <label><input type="checkbox" id="invertX"> Invert X</label><br>
    <label><input type="checkbox" id="hideCursor"> Hide Cursor</label><br>
    <label>Player Color <input type="color" id="playerColor" value="#0000ff"></label><br>
    <label>Wall Color <input type="color" id="wallColor" value="#aaaaaa"></label><br>
    <label>Goal Color <input type="color" id="goalColor" value="#00ff00"></label><br>
    <label><input type="checkbox" id="toggleObstacles" checked> Obstacles</label>
  </div>
  <div id="overlay">
    <div id="message">Goal Reached</div>
    <button onclick="resetGame()">Reset</button>
  </div>
  <div id="gameContainer"></div>

  <script>
    let player, goal;
    let walls = [];
    let obstacles = [];
    let sensitivity = 5, deadzone = 5, maxSpeed = 200;
    let invertX = false;
    let playerColor = 0x0000ff;
    let wallColor = 0xaaaaaa;
    let goalColor = 0x00ff00;

    const overlay = document.getElementById('overlay');
    const messageEl = document.getElementById('message');

    function resetGame() {
      overlay.style.display = 'none';
      player.x = 100; player.y = 100;
      player.body.setVelocity(0,0);
    }

    const config = {
      type: Phaser.AUTO,
      parent: 'gameContainer',
      width: window.innerWidth,
      height: window.innerHeight,
      backgroundColor: '#ffffff',
      physics: { default: 'arcade', arcade: { debug:false }},
      scene: { preload, create, update }
    };

    const game = new Phaser.Game(config);

    function preload() {}

    function create() {
      player = this.add.circle(100, 100, 50, playerColor);
      this.physics.add.existing(player);
      player.body.setCollideWorldBounds(true);

      goal = this.add.rectangle(config.width-150, config.height-150, 100, 100, goalColor);
      this.physics.add.existing(goal);

      // Walls
      let wallTop = this.add.rectangle(config.width/2, 0, config.width, 20, wallColor).setOrigin(0.5,0);
      let wallBottom = this.add.rectangle(config.width/2, config.height, config.width, 20, wallColor).setOrigin(0.5,1);
      let wallLeft = this.add.rectangle(0, config.height/2, 20, config.height, wallColor).setOrigin(0,0.5);
      let wallRight = this.add.rectangle(config.width, config.height/2, 20, config.height, wallColor).setOrigin(1,0.5);
      walls = [wallTop, wallBottom, wallLeft, wallRight];
      walls.forEach(w => { this.physics.add.existing(w, true); this.physics.add.collider(player, w); });

      // Obstacles
      addObstacles(this);

      this.physics.add.overlap(player, goal, () => {
        messageEl.innerText = 'Goal Reached';
        overlay.style.display = 'flex';
      });

      this.input.on('pointerdown', () => {
        this.input.mouse.requestPointerLock();
      });

      this.input.on('pointermove', (pointer) => {
        if (this.input.mouse.locked) {
          let dx = pointer.movementX;
          let dy = pointer.movementY;
          if (invertX) dx = -dx;
          if (Math.abs(dx) < deadzone) dx = 0;
          if (Math.abs(dy) < deadzone) dy = 0;
          // Calculate step velocity
          let vx = dx * sensitivity;
          let vy = dy * sensitivity;
          // Apply max speed limiter
          if (vx > maxSpeed) vx = maxSpeed;
          if (vx < -maxSpeed) vx = -maxSpeed;
          if (vy > maxSpeed) vy = maxSpeed;
          if (vy < -maxSpeed) vy = -maxSpeed;

          player.body.setVelocity(vx, vy);
          setTimeout(()=>{ if(player) player.body.setVelocity(0,0); }, 50);
        }
      });

      this.physics.add.collider(player, obstacles, () => {
        messageEl.innerText = 'Game Over';
        overlay.style.display = 'flex';
      });
    }

    function update() {
      // Step-based, no continuous velocity
    }

    function addObstacles(scene) {
      obstacles.forEach(o=>o.destroy());
      obstacles = [];
      if (!document.getElementById('toggleObstacles').checked) return;
      let obs1 = scene.add.rectangle(config.width/2, config.height/2, 200, 40, 0x888888);
      let obs2 = scene.add.rectangle(config.width/2+150, config.height/2-100, 40, 200, 0x888888);
      obstacles = [obs1, obs2];
      obstacles.forEach(o => { scene.physics.add.existing(o, true); scene.physics.add.collider(player,o,()=>{
        messageEl.innerText = 'Game Over'; overlay.style.display = 'flex';
      }); });
    }

    // UI Events
    document.getElementById('toggleBtn').onclick = ()=>{
      let sp = document.getElementById('settingsPanel');
      sp.style.display = sp.style.display==='block' ? 'none' : 'block';
    };
    document.getElementById('sensitivity').oninput = e=> sensitivity=parseFloat(e.target.value);
    document.getElementById('deadzone').oninput = e=> deadzone=parseFloat(e.target.value);
    document.getElementById('maxSpeed').oninput = e=> { 
      maxSpeed=parseFloat(e.target.value); 
      document.getElementById('maxSpeedLabel').innerText = maxSpeed;
    };
    document.getElementById('playerSize').oninput = e=> { if(player) player.setRadius(parseInt(e.target.value)); };
    document.getElementById('invertX').onchange = e=> invertX=e.target.checked;
    document.getElementById('hideCursor').onchange = e=> document.body.style.cursor=e.target.checked?'none':'default';
    document.getElementById('playerColor').oninput = e=> { playerColor=Phaser.Display.Color.HexStringToColor(e.target.value).color; if(player) player.fillColor=playerColor; };
    document.getElementById('wallColor').oninput = e=> { wallColor=Phaser.Display.Color.HexStringToColor(e.target.value).color; walls.forEach(w=>w.fillColor=wallColor); };
    document.getElementById('goalColor').oninput = e=> { goalColor=Phaser.Display.Color.HexStringToColor(e.target.value).color; if(goal) goal.fillColor=goalColor; };
    document.getElementById('toggleObstacles').onchange = ()=> addObstacles(game.scene.keys.default);
  </script>
</body>
</html>
